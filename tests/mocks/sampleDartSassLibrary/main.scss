// ============================================
// Main Entry Point
// Compiles all SCSS modules into a single stylesheet
// ============================================

// Import Dart Sass modules
@use "sass:color";
@use "sass:math";
@use "sass:map";
@use "sass:list";
@use "sass:string";
@use "sass:meta";
@use "sass:selector";

// ============================================
// Abstracts (No CSS output, tools only)
// ============================================
@use "abstracts" as *;

// ============================================
// Themes (CSS Custom Properties)
// Must come before components that use them
// ============================================
@use "themes";

// ============================================
// Base Styles
// ============================================
@use "base";

// ============================================
// Layout Primitives
// ============================================
@use "layout";

// ============================================
// Components
// ============================================
@use "components";

// ============================================
// Utilities
// Must come last to allow overrides
// ============================================
@use "utilities";

// ============================================
// CSS Modules Global Styles Demo
// Using :global() for CSS Modules interop
// ============================================

// In CSS Modules, :global() escapes local scoping.
// The syntax `:global(.class)` makes .class globally available.
// Since Dart Sass doesn't process CSS Modules syntax directly,
// here we demonstrate the pattern with regular selectors.

// Focus-visible polyfill styles (global by nature)
.js-focus-visible :focus:not(.focus-visible) {
	outline: none;
}

.js-focus-visible .focus-visible {
	outline: 2px solid $color-primary-500;
	outline-offset: 2px;
}

// In a CSS Modules context (.module.scss), you would use:
// :global(.external-class) { ... } to escape scoping
// For this demo, we show the equivalent global styles:
.external-widget-integration {
	&.is-active {
		background: $color-primary-100;
	}
}

// ============================================
// Advanced Nesting Examples
// ============================================

// Deep nesting with parent selector
.component {
	$self: &;

	display: block;
	padding: space(4);
	background: var(--color-surface-default);
	border-radius: radius("lg");

	// Nested element
	&__header {
		display: flex;
		align-items: center;
		justify-content: space-between;
		margin-bottom: space(4);

		// Double nested
		#{$self}__title {
			font-size: font-size("lg");
			font-weight: font-weight("semibold");
		}

		#{$self}__actions {
			display: flex;
			gap: space(2);
		}
	}

	&__body {
		color: var(--color-text-secondary);
		line-height: line-height("relaxed");

		// Nested with complex selectors
		> p + p {
			margin-top: space(4);
		}

		// Link styling within body
		a {
			color: var(--color-text-link);

			&:hover {
				color: var(--color-text-link-hover);
				text-decoration: underline;
			}
		}
	}

	&__footer {
		margin-top: space(4);
		padding-top: space(4);
		border-top: 1px solid var(--color-border-default);
	}

	// State modifiers
	&--featured {
		border: 2px solid $color-primary-500;
		box-shadow: shadow("lg");

		#{$self}__header {
			background: alpha($color-primary-500, 0.1);
			margin: calc(-1 * space(4));
			margin-bottom: space(4);
			padding: space(4);
		}
	}

	&--compact {
		padding: space(3);

		#{$self}__header {
			margin-bottom: space(2);
		}

		#{$self}__footer {
			margin-top: space(2);
			padding-top: space(2);
		}
	}

	// Interactive state
	&--clickable {
		cursor: pointer;

		@include transition((transform, box-shadow));

		&:hover {
			transform: translateY(-2px);
			box-shadow: shadow("lg");
		}

		&:active {
			transform: translateY(0);
		}
	}

	// Responsive adjustments
	@include mq-down("sm") {
		padding: space(3);

		&__header {
			flex-direction: column;
			align-items: flex-start;
			gap: space(2);
		}
	}
}

// ============================================
// Complex Color Manipulation Demo
// ============================================

.color-demo {
	// Using color.hwb()
	--color-hwb-example: #{color.hwb(210, 10%, 20%)};

	// Using color.complement()
	--color-complement: #{color.complement($color-primary-500)};

	// Using color.invert()
	--color-inverted: #{color.invert($color-primary-500)};

	// Using color.grayscale()
	--color-grayscale: #{color.grayscale($color-primary-500)};

	// Complex color mixing
	--color-mixed: #{color.mix(
			color.adjust($color-primary-500, $hue: 30deg),
			color.adjust($color-secondary-base, $saturation: -20%),
			40%
		)};

	// Using color.channel()
	--primary-hue: #{color.channel($color-primary-500, "hue")};
	--primary-saturation: #{color.channel($color-primary-500, "saturation")};
	--primary-lightness: #{color.channel($color-primary-500, "lightness")};
}

// ============================================
// Advanced Selector Manipulation
// ============================================

// Using selector functions
$base-selector: ".widget";
$state-selector: selector.append($base-selector, "--active");
$nested-selector: selector.nest($base-selector, "&__content");

#{$base-selector} {
	display: block;
}

#{$state-selector} {
	background: $color-primary-100;
}

// Selector unification
$unified: selector.unify(".btn", ".btn-primary");

#{$unified} {
	font-weight: font-weight("bold");
}

// ============================================
// Print Styles
// ============================================

@include print {
	*,
	*::before,
	*::after {
		background: transparent !important;
		color: $color-black !important;
		box-shadow: none !important;
		text-shadow: none !important;
	}

	a,
	a:visited {
		text-decoration: underline;
	}

	a[href]::after {
		content: " (" attr(href) ")";
	}

	abbr[title]::after {
		content: " (" attr(title) ")";
	}

	// Don't show links for images, or internal/javascript links
	a[href^="#"]::after,
	a[href^="javascript:"]::after {
		content: "";
	}

	pre,
	blockquote {
		border: 1px solid $color-neutral-400;
		page-break-inside: avoid;
	}

	img {
		max-width: 100% !important;
		page-break-inside: avoid;
	}

	p,
	h2,
	h3 {
		orphans: 3;
		widows: 3;
	}

	h2,
	h3 {
		page-break-after: avoid;
	}

	// Hide non-essential elements
	nav,
	.no-print {
		display: none !important;
	}
}

// ============================================
// Container Queries Demo
// ============================================

.container-query-demo {
	container-type: inline-size;
	container-name: card-container;

	.card-cq {
		display: grid;
		gap: space(4);

		@container card-container (min-width: 400px) {
			grid-template-columns: 150px 1fr;
		}

		@container card-container (min-width: 600px) {
			grid-template-columns: 200px 1fr auto;
		}
	}
}

// ============================================
// Layer Cascade Demo
// ============================================

@layer reset, base, components, utilities;

@layer reset {
	*,
	*::before,
	*::after {
		box-sizing: border-box;
	}
}

@layer base {
	body {
		font-family: $font-family-sans;
	}
}

@layer components {
	.layer-demo-btn {
		padding: space(2) space(4);
		background: $color-primary-600;
		color: $color-white;
	}
}

@layer utilities {
	.layer-demo-hidden {
		display: none !important;
	}
}
